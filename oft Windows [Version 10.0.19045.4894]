[1mdiff --git a/core/__pycache__/logic.cpython-311.pyc b/core/__pycache__/logic.cpython-311.pyc[m
[1mindex 59d40f7..ad1e95c 100644[m
Binary files a/core/__pycache__/logic.cpython-311.pyc and b/core/__pycache__/logic.cpython-311.pyc differ
[1mdiff --git a/core/groq.py b/core/groq.py[m
[1mindex a8e1a32..48a93aa 100644[m
[1m--- a/core/groq.py[m
[1m+++ b/core/groq.py[m
[36m@@ -1,6 +1,7 @@[m
 import os[m
[32m+[m[32mimport re[m
 from dotenv import load_dotenv[m
[31m-from openai import OpenAI  # âœ… Ä‘Ãºng cÃº phÃ¡p cho SDK má»›i[m
[32m+[m[32mfrom openai import OpenAI[m
 [m
 load_dotenv()[m
 [m
[36m@@ -10,27 +11,23 @@[m [mclient = OpenAI([m
 )[m
 [m
 [m
[31m-def loc_lich_su(lich_su):[m
[31m-    """Lá»c bá» cÃ¡c cÃ¢u tráº£ lá»i xin lá»—i khÃ´ng cáº§n thiáº¿t Ä‘á»ƒ trÃ¡nh láº·p láº¡i"""[m
[31m-    return [[m
[31m-        msg for msg in lich_su[m
[31m-        if not ([m
[31m-            msg['role'] == 'assistant' and[m
[31m-            msg['content'].strip().lower().startswith("xin lá»—i")[m
[31m-        )[m
[31m-    ][m
[31m-[m
[31m-[m
 def lam_dep_cau_tra_loi_groq(cau_hoi, noi_dung_tham_khao, ngu_canh=None):[m
[32m+[m[32m    def loc_lich_su(lich_su):[m
[32m+[m[32m        return [[m
[32m+[m[32m            msg for msg in lich_su[m
[32m+[m[32m            if not ([m
[32m+[m[32m                msg['role'] == 'assistant' and[m
[32m+[m[32m                msg['content'].strip().lower().startswith("xin lá»—i")[m
[32m+[m[32m            )[m
[32m+[m[32m        ][m
 [m
     ngu_canh = loc_lich_su(ngu_canh or [])[m
 [m
[31m-    # XÃ¢y messages vá»›i prompt rÃµ rÃ ng, háº¡n cháº¿ xin lá»—i[m
     messages = [[m
         {"role": "system", "content": ([m
             "Báº¡n lÃ  má»™t trá»£ lÃ½ AI tiáº¿ng Viá»‡t Ä‘Ã¡ng tin cáº­y. "[m
[31m-            "Chá»‰ tráº£ lá»i dá»±a trÃªn thÃ´ng tin Ä‘Ã£ cÃ³. "[m
[31m-            "KhÃ´ng cáº§n xin lá»—i náº¿u khÃ´ng thá»±c sá»± cÃ³ lá»—i."[m
[32m+[m[32m            "Chá»‰ tráº£ lá»i dá»±a trÃªn thÃ´ng tin cÃ³ tháº­t. "[m
[32m+[m[32m            "KhÃ´ng bá»‹a chuyá»‡n vÃ  khÃ´ng xin lá»—i khi khÃ´ng cáº§n thiáº¿t."[m
         )}[m
     ] + ngu_canh[m
 [m
[36m@@ -39,19 +36,34 @@[m [mdef lam_dep_cau_tra_loi_groq(cau_hoi, noi_dung_tham_khao, ngu_canh=None):[m
     if noi_dung_tham_khao:[m
         messages.append({"role": "assistant", "content": noi_dung_tham_khao})[m
 [m
[31m-    # YÃªu cáº§u lÃ m rÃµ láº¡i[m
     messages.append({[m
         "role": "user",[m
[31m-        "content": "HÃ£y viáº¿t láº¡i cÃ¢u tráº£ lá»i máº¡ch láº¡c, rÃµ rÃ ng, thÃ¢n thiá»‡n, chÃ­nh xÃ¡c thÃ´ng tin tra cá»©u Ä‘Æ°Æ¡c, khÃ´ng bá»‹a chuyá»‡n. KhÃ´ng láº·p láº¡i xin lá»—i nhiá»u láº§n."[m
[32m+[m[32m        "content": ([m
[32m+[m[32m            "Viáº¿t láº¡i cÃ¢u tráº£ lá»i máº¡ch láº¡c, rÃµ rÃ ng, thÃ¢n thiá»‡n, chÃ­nh xÃ¡c vÃ  pháº£i trÃ­ch nguá»“n náº¿u cÃ³"[m
[32m+[m[32m            "yÃªu cáº§u: TÃªn nhÃ¢n váº­t pháº£i Ä‘á»§ thÃ´ng tin má»›i nÃªu, khÃ´ng gÃ¡n ghÃ©p, khÃ´ng Ä‘Æ°á»£c Ä‘oÃ¡n hay bá»‹a Ä‘áº·t tÃªn nhÃ¢n váº­t khi thÃ´ng tin khÃ´ng rÃµ rÃ ng. "[m
[32m+[m[32m            "Cuá»‘i cÃ¹ng, ghi rÃµ dÃ²ng sau:\n"[m
[32m+[m[32m            "[DANH_TU_RIENG: tÃªn Ä‘áº§y Ä‘á»§ hoáº·c chá»§ Ä‘á» chÃ­nh mÃ  ngÆ°á»i dÃ¹ng Ä‘ang Ä‘á» cáº­p náº¿u cÃ³]"[m
[32m+[m[32m        )[m
     })[m
 [m
     try:[m
         ket_qua = client.chat.completions.create([m
             model="llama3-8b-8192",[m
             messages=messages,[m
[31m-            temperature=0.7,  # TÄƒng chÃºt Ä‘á»ƒ vÄƒn phong tá»± nhiÃªn[m
[31m-            max_tokens=300[m
[32m+[m[32m            temperature=0.7,[m
[32m+[m[32m            max_tokens=400[m
         )[m
[31m-        return ket_qua.choices[0].message.content.strip()[m
[32m+[m[32m        content = ket_qua.choices[0].message.content.strip()[m
[32m+[m
[32m+[m[32m        match = re.search(r"\[DANH_TU_RIENG:(.*?)\]\s*$", content, re.DOTALL)[m
[32m+[m[32m        danh_tu_rieng = [][m
[32m+[m[32m        if match:[m
[32m+[m[32m            danh_tu_rieng = list([m
[32m+[m[32m                {ten.strip() for ten in match.group(1).split(",") if ten.strip()}[m
[32m+[m[32m            )[m
[32m+[m[32m            content = content[:match.start()].strip()[m
[32m+[m
[32m+[m[32m        return content, danh_tu_rieng[m
[32m+[m
     except Exception as e:[m
[31m-        return f"[Lá»—i tá»« Groq] {e}"[m
[32m+[m[32m        return f"[Lá»—i tá»« Groq] {e}", [][m
[1mdiff --git a/core/logic.py b/core/logic.py[m
[1mindex ef7383f..05ad8a3 100644[m
[1m--- a/core/logic.py[m
[1m+++ b/core/logic.py[m
[36m@@ -21,22 +21,28 @@[m [mdef tach_tu_khoa(text):[m
     return cum_tu_khoa[m
 [m
 [m
[31m-def capnhat(user_input, user_response, history):[m
[31m-    """Cáº­p nháº­t Ä‘oáº¡n há»™i thoáº¡i + xá»­ lÃ½ cÃ¢u tráº£ lá»i sao cho Ä‘áº¹p"""[m
[32m+[m[32mdef capnhat(user_input, user_response, history, sources=None):[m
[32m+[m[32m    """Cáº­p nháº­t Ä‘oáº¡n há»™i thoáº¡i + xá»­ lÃ½ cÃ¢u tráº£ lá»i sao cho Ä‘áº¹p, cÃ³ trÃ­ch nguá»“n"""[m
     if user_response:[m
[31m-        chatgpt_output = lam_dep_cau_tra_loi_groq([m
[31m-            user_input, user_response, history[m
[32m+[m[32m        if sources:[m
[32m+[m[32m            noi_dung_tham_khao = user_response + "\n\nğŸ”— Nguá»“n tham kháº£o:\n" + \[m
[32m+[m[32m                "\n".join(f"- {src}" for src in sources)[m
[32m+[m[32m        else:[m
[32m+[m[32m            noi_dung_tham_khao = user_response[m
[32m+[m
[32m+[m[32m        chatgpt_output, danh_tu_rieng = lam_dep_cau_tra_loi_groq([m
[32m+[m[32m            user_input, noi_dung_tham_khao, history[m
         )[m
 [m
[31m-        # Cáº­p nháº­t láº¡i lá»‹ch sá»­: user â†’ assistant[m
         history += [[m
             {"role": "user", "content": user_input},[m
             {"role": "assistant", "content": chatgpt_output}[m
         ][m
     else:[m
         chatgpt_output = f"Xin lá»—i, tÃ´i khÃ´ng tÃ¬m tháº¥y thÃ´ng tin cho: {user_input}"[m
[32m+[m[32m        danh_tu_rieng = [][m
 [m
[31m-    return chatgpt_output, history[m
[32m+[m[32m    return chatgpt_output, history, danh_tu_rieng[m
 [m
 [m
 def tieptuc_traloi(all_text, current_position):[m
[1mdiff --git a/ghidulieu.py b/ghidulieu.py[m
[1mindex 82b8a42..d22152e 100644[m
[1m--- a/ghidulieu.py[m
[1m+++ b/ghidulieu.py[m
[36m@@ -1,24 +1,24 @@[m
[32m+[m[32m# ngu_canh_truy_van.py[m
 [m
[31m-import pandas as pd[m
[32m+[m[32mdef co_can_bo_sung_chu_de(user_input: str) -> bool:[m
[32m+[m[32m    """[m
[32m+[m[32m    Kiá»ƒm tra xem user_input cÃ³ chá»©a Ä‘áº¡i tá»« hoáº·c tá»« chá»‰ mÆ¡ há»“,[m
[32m+[m[32m    náº¿u cÃ³ thÃ¬ cáº§n bá»• sung chá»§ Ä‘á» (danh tá»« riÃªng) vÃ o cÃ¢u há»i.[m
[32m+[m[32m    """[m
[32m+[m[32m    tu_dai_dien = [[m
[32m+[m[32m        "Ã´ng áº¥y", "bÃ  áº¥y", "há»", "nÃ³", "cÃ´ áº¥y", "cáº­u áº¥y", "ngÆ°á»i áº¥y", "anh ta", "chá»‹ ta",[m
[32m+[m[32m        "vá»‹ Ä‘Ã³", "nhÃ¢n váº­t Ä‘Ã³", "váº­t Ä‘Ã³", "váº­t nÃ y", "chuyá»‡n Ä‘Ã³", "viá»‡c áº¥y", "chá»§ Ä‘á» Ä‘Ã³",[m
[32m+[m[32m        "nÃ³ lÃ  gÃ¬", "viá»‡c Ä‘Ã³", "hÃ nh Ä‘á»™ng Ä‘Ã³", "Ä‘iá»u Ä‘Ã³", "trÆ°á»ng há»£p Ä‘Ã³"[m
[32m+[m[32m    ][m
[32m+[m[32m    user_input = user_input.lower()[m
[32m+[m[32m    return any(cum in user_input for cum in tu_dai_dien)[m
 [m
 [m
[31m-def ghi_dulieu(user_input, chatgpt_output):[m
[31m-    new_data = pd.DataFrame([m
[31m-        {"Question": [user_input], "Answer": [chatgpt_output]})[m
[31m-    existing_data = pd.read_excel('sau.xlsx') if pd.read_excel([m
[31m-        'sau.xlsx') is not None else pd.DataFrame()[m
[31m-    updated_data = pd.concat([m
[31m-        [existing_data, new_data], ignore_index=True)[m
[31m-    updated_data.to_excel('sau.xlsx', index=False)[m
[31m-[m
[31m-[m
[31m-def doc_dulieu():[m
[31m-    # Äá»c dá»¯ liá»‡u tá»« file Excel[m
[31m-    data = pd.read_excel('sau.xlsx')[m
[31m-    # Chuyá»ƒn Ä‘á»•i cÃ¡c kiá»ƒu dá»¯ liá»‡u thÃ nh chuá»—i vÄƒn báº£n[m
[31m-    data['Question'] = data['Question'].astype(str)[m
[31m-    data['Answer'] = data['Answer'].astype(str)[m
[31m-    qa_dict = data.set_index('Question')['Answer'].to_dict()[m
[31m-    # Táº¡o tá»« Ä‘iá»ƒn qa_dict tá»« dá»¯ liá»‡u[m
[31m-    # tu_dien = new_func(data)[m
[31m-    return qa_dict[m
[32m+[m[32mdef tao_truy_van_bo_sung(user_input: str, danh_tu_rieng_truoc_do: str = None) -> str:[m
[32m+[m[32m    """[m
[32m+[m[32m    Náº¿u cÃ¢u há»i cáº§n thÃªm chá»§ Ä‘á» thÃ¬ ná»‘i chá»§ Ä‘á» cÅ© vÃ o Ä‘áº§u cÃ¢u há»i.[m
[32m+[m[32m    Náº¿u khÃ´ng, tráº£ láº¡i nguyÃªn vÄƒn user_input.[m
[32m+[m[32m    """[m
[32m+[m[32m    if danh_tu_rieng_truoc_do and co_can_bo_sung_chu_de(user_input):[m
[32m+[m[32m        return f"{danh_tu_rieng_truoc_do.strip()} {user_input.strip()}"[m
[32m+[m[32m    return user_input.strip()[m
[1mdiff --git a/keyword_expander.py b/keyword_expander.py[m
[1mnew file mode 100644[m
[1mindex 0000000..1d22105[m
[1m--- /dev/null[m
[1m+++ b/keyword_expander.py[m
[36m@@ -0,0 +1,97 @@[m
[32m+[m[32mimport re[m
[32m+[m[32m# Stopwords Ä‘á»ƒ loáº¡i bá» tá»« khÃ³a nhiá»…u[m
[32m+[m[32mSTOPWORDS = {[m
[32m+[m[32m    "gÃ¬", "nÃ o", "ai", "sao", "Ã ", "vÃ ", "cÃ¡c", "cá»§a", "lÃ ",[m
[32m+[m[32m    "áº¥y", "thÃ¬", "á»Ÿ", "Ä‘Ã¢u", "ra", "nÃ³", "nhÆ°ng", "nhá»¯ng", "háº£", "sáº½", "máº¥y"[m
[32m+[m[32m}[m
[32m+[m[32mSTOP_PHRASES = [[m
[32m+[m[32m    "bao nhiÃªu", "nhÆ° tháº¿ nÃ o", "lÃ m sao", "á»Ÿ Ä‘Ã¢u", "khi nÃ o", "lÃ  gÃ¬", "táº¡i sao", "vÃ¬ sao", "táº¡i vÃ¬ sao",[m
[32m+[m[32m    "ai lÃ ", "ai Ä‘Ã£", "ai Ä‘ang", "cÃ³ Ä‘Ãºng khÃ´ng", "cÃ³ pháº£i lÃ ", "cÃ³ thá»ƒ", "cÃ³ hay khÃ´ng", "cÃ³ khÃ´ng",[m
[32m+[m[32m    "nÃ o lÃ ", "cÃ¡i gÃ¬", "gÃ¬ váº­y", "tháº¿ nÃ o", "cÃ¡ch nÃ o", "pháº£i khÃ´ng", "ra sao", "Ä‘á»ƒ lÃ m gÃ¬",[m
[32m+[m[32m    "máº¥y giá»", "máº¥y tuá»•i", "bao nhiÃªu", "kÃ©o dÃ i bao lÃ¢u",[m
[32m+[m[32m    "báº±ng cÃ¡ch nÃ o", "vÃ¬ Ä‘iá»u gÃ¬", "cÃ³ nghÄ©a lÃ  gÃ¬", "Ä‘Æ°á»£c khÃ´ng", "Ä‘Æ°á»£c chá»©", "báº¡n cÃ³ biáº¿t", "lÃ  gÃ¬", "lÃ  ai", "cÃ³ biáº¿t"[m
[32m+[m[32m][m
[32m+[m[32m# Bá»™ má»Ÿ rá»™ng tá»« khÃ³a theo loáº¡i cÃ¢u há»i[m
[32m+[m[32mBO_TU_MO_RONG = {[m
[32m+[m[32m    "trong": ["ngoÃ i", "trÃªn", "dÆ°á»›i", "trong"],[m
[32m+[m[32m    "Ä‘Ã³ lÃ  gÃ¬": ["Ä‘Ã³ lÃ ", "gá»i lÃ ", "Ä‘Æ°á»£c xem lÃ ", "Ä‘Ã¢y lÃ "],[m
[32m+[m[32m    "á»Ÿ Ä‘Ã¢u": ["á»Ÿ", "táº¡i", "nÆ¡i", "Ä‘á»‹a Ä‘iá»ƒm", "quÃª", "xuáº¥t thÃ¢n"],[m
[32m+[m[32m    "khi nÃ o": ["khi", "nÄƒm", "thÃ¡ng", "ngÃ y", "lÃºc", "thá»i gian", "thá»i Ä‘iá»ƒm"],[m
[32m+[m[32m    "vÃ¬ sao": ["vÃ¬", "do", "táº¡i vÃ¬", "bá»Ÿi vÃ¬", "nguyÃªn nhÃ¢n", "lÃ½ do"],[m
[32m+[m[32m    "nhÆ° tháº¿ nÃ o": ["nhÆ° tháº¿ nÃ y", "cÃ¡ch", "ra sao", "mÃ´ táº£", "kiá»ƒu", "dáº¡ng", "Ä‘áº·c Ä‘iá»ƒm"],[m
[32m+[m[32m    "bao nhiÃªu": ["sá»‘", "tá»•ng", "khoáº£ng", "chá»«ng"],[m
[32m+[m[32m    "Ä‘ang lÃ m gÃ¬": ["Ä‘ang lÃ m", "hÃ nh Ä‘á»™ng", "thá»±c hiá»‡n", "cÃ´ng viá»‡c"],[m
[32m+[m[32m    "phu nhÃ¢n": ["phu nhÃ¢n", "vá»£"],[m
[32m+[m[32m    "chá»“ng": ["chá»“ng", "phu quÃ¢n"],[m
[32m+[m[32m    "triá»u Ä‘Ã¬nh": ["triá»u Ä‘Ã¬nh", "vua quan", "hoÃ ng vÆ°Æ¡ng", "vua chÃºa", "hoÃ ng triá»u"],[m
[32m+[m[32m    "Ã´ng": ["Ã´ng", "cá»¥", "ngÃ i", "lÃ£o"],[m
[32m+[m[32m    "bÃ ": ["bÃ ", "cÃ´", "má»£", "thÃ­m", "chá»‹", "dÃ¬"],[m
[32m+[m[32m    "Ä‘Ã¬nh": ["Ä‘Ã¬nh", "Ä‘á»n", "miáº¿u", "chÃ¹a", "nÆ¡i thá»"],[m
[32m+[m[32m    "quan": ["quan", "quan láº¡i", "quan chá»©c", "chá»©c tÆ°á»›c", "viÃªn chá»©c"],[m
[32m+[m[32m    "quÃª": ["quÃª", "quÃ¡n", "nÆ¡i sinh", "sinh sá»‘ng", "hiá»‡n á»Ÿ táº¡i"],[m
[32m+[m[32m    "cháº¿t": ["cháº¿t", "máº¥t", "tá»­ vong", "qua Ä‘á»i"],[m
[32m+[m[32m    "hiá»‡n nay": ["Ä‘ang", "hiá»‡n nay"][m
[32m+[m[32m}[m
[32m+[m
[32m+[m
[32m+[m[32mdef tach_tu_khoa(text):[m
[32m+[m[32m    """TÃ¡ch tá»« tá»« vÄƒn báº£n vÃ  loáº¡i bá» stopwords."""[m
[32m+[m[32m    words = text.split()[m
[32m+[m[32m    keywords = [[m
[32m+[m[32m        word.lower().rstrip(".,?!")[m
[32m+[m[32m        for word in words[m
[32m+[m[32m        if word.lower().rstrip(".,?!") not in STOPWORDS[m
[32m+[m[32m    ][m
[32m+[m[32m    return keywords if keywords else [[m
[32m+[m[32m        word.lower().rstrip(".,?!") for word in words[m
[32m+[m[32m    ][m
[32m+[m
[32m+[m
[32m+[m[32mdef tach_tu_khoa(text: str):[m
[32m+[m[32m    """TÃ¡ch cÃ¡c tá»« cÃ³ nghÄ©a, loáº¡i bá» stopwords Ä‘Æ¡n."""[m
[32m+[m[32m    words = text.split()[m
[32m+[m[32m    keywords = [[m
[32m+[m[32m        word.lower().rstrip(".,?!")[m
[32m+[m[32m        for word in words[m
[32m+[m[32m        if word.lower().rstrip(".,?!") not in STOPWORDS[m
[32m+[m[32m    ][m
[32m+[m[32m    return keywords if keywords else [w.lower().rstrip(".,?!") for w in words][m
[32m+[m
[32m+[m
[32m+[m[32mdef loc_tu_quan_trong(cau_hoi: str):[m
[32m+[m[32m    """Loáº¡i cá»¥m tá»« dÆ° thá»«a vÃ  chá»‰ giá»¯ tá»« trá»ng tÃ¢m."""[m
[32m+[m[32m    cau_hoi = cau_hoi.lower()[m
[32m+[m[32m    cau_hoi = re.sub(r"[^\w\s]", "", cau_hoi)[m
[32m+[m
[32m+[m[32m    for phrase in STOP_PHRASES:[m
[32m+[m[32m        cau_hoi = cau_hoi.replace(phrase, "")[m
[32m+[m
[32m+[m[32m    words = cau_hoi.split()[m
[32m+[m[32m    return [w for w in words if w not in STOPWORDS][m
[32m+[m
[32m+[m
[32m+[m[32mdef expand_keywords(user_input: str):[m
[32m+[m[32m    """[m
[32m+[m[32m    Tráº£ vá» táº­p tá»« khÃ³a má»Ÿ rá»™ng Ä‘á»ƒ tÃ¬m kiáº¿m:[m
[32m+[m[32m    - TÃ¡ch tá»« chÃ­nh trong input[m
[32m+[m[32m    - Má»Ÿ rá»™ng theo nhÃ³m nghÄ©a Æ°u tiÃªn[m
[32m+[m[32m    - Fix: khÃ´ng khá»›p sai tá»« do trÃ¹ng chuá»—i con (vd: 'Ã´ng' trong 'cÃ´ng')[m
[32m+[m[32m    """[m
[32m+[m[32m    base_keywords = tach_tu_khoa(user_input)[m
[32m+[m[32m    question_lower = user_input.lower()[m
[32m+[m[32m    mo_rong = [][m
[32m+[m
[32m+[m[32m    for nhom, cum_tu in BO_TU_MO_RONG.items():[m
[32m+[m[32m        for phrase in cum_tu:[m
[32m+[m[32m            # Khá»›p chÃ­nh xÃ¡c tá»«/cá»¥m báº±ng regex Ä‘á»ƒ trÃ¡nh khá»›p chuá»—i con[m
[32m+[m[32m            pattern = r'\b' + re.escape(phrase) + r'\b'[m
[32m+[m[32m            if re.search(pattern, question_lower):[m
[32m+[m[32m                mo_rong.extend(cum_tu)[m
[32m+[m[32m                break[m
[32m+[m
[32m+[m[32m    # TÃ¡ch cá»¥m má»Ÿ rá»™ng thÃ nh tá»« Ä‘Æ¡n (giá»¯ nhÆ° code gá»‘c)[m
[32m+[m[32m    tu_don_tu_cum = [][m
[32m+[m[32m    for cum in mo_rong:[m
[32m+[m[32m        tu_don_tu_cum.extend(cum.lower().split())[m
[32m+[m
[32m+[m[32m    return list(set(base_keywords + tu_don_tu_cum))[m
[1mdiff --git a/lodanhtu.py b/lodanhtu.py[m
[1mindex 7877fe0..c55f559 100644[m
[1m--- a/lodanhtu.py[m
[1m+++ b/lodanhtu.py[m
[36m@@ -37,9 +37,10 @@[m [mdef filter_verbs():[m
 if __name__ == "__main__":[m
 [m
     speak_text("Má»i báº¡n báº¯t Ä‘áº§u Ä‘á»c má»™t cÃ¢u")[m
[31m-    input_sentence = recognize_speech().strip().replace('\n', '')[m
[32m+[m[32m    input_sentence = input("User: ").strip().replace('\n', '')[m
     # PhÃ¢n tÃ­ch cÃº phÃ¡p cÃ¢u Ä‘á»ƒ Ä‘Ã¡nh dáº¥u loáº¡i tá»« (POS tagging)[m
     tagged_words = pos_tag(input_sentence)[m
[32m+[m[32m    print(tagged_words)[m
     nouns = filter_nouns()[m
     adjectives = filter_adjectives()[m
     verbs = filter_verbs()[m
[1mdiff --git a/main.py b/main.py[m
[1mindex c9a540b..11cb2ca 100644[m
[1m--- a/main.py[m
[1m+++ b/main.py[m
[36m@@ -6,10 +6,10 @@[m [mfrom module_ggl import ([m
 )[m
 from module_xuli import hien_thi_vien_va_con_tro[m
 from nghe_noi import recognize_speech1, speak_text1, speak_text[m
[31m-import pandas as pd[m
 from datetime import datetime[m
 from core.handle_input import sau, bay, tu_dien, ghi_dulieu_txt[m
 from core.logic import tieptuc_traloi, tach_tu_khoa, capnhat[m
[32m+[m[32mfrom ngu_canh_truy_van import tao_truy_van_bo_sung[m
 # Tráº¡ng thÃ¡i phiÃªn trÃ² chuyá»‡n (session Ä‘Æ¡n giáº£n trong bá»™ nhá»›)[m
 user_context = {[m
     "tiep": None,[m
[36m@@ -28,14 +28,20 @@[m [mdef chatbot_response(user_input):[m
         if not user_input:[m
             return "Xin vui lÃ²ng cho biáº¿t yÃªu cáº§u cá»§a báº¡n"[m
 [m
[32m+[m[32m        # Khá»Ÿi táº¡o context náº¿u chÆ°a cÃ³[m
         if "history" not in user_context:[m
             user_context["history"] = [][m
[32m+[m[32m        if "danh_tu_rieng_truoc_do" not in user_context:[m
[32m+[m[32m            user_context["danh_tu_rieng_truoc_do"] = None[m
 [m
[32m+[m[32m        # XÃ³a ngá»¯ cáº£nh[m
         if user_input == "xÃ³a ngá»¯ cáº£nh":[m
             xoa_ngucanh()[m
             user_context["history"] = [][m
[32m+[m[32m            user_context["danh_tu_rieng_truoc_do"] = None[m
             return "Ngá»¯ cáº£nh Ä‘Ã£ Ä‘Æ°á»£c xÃ³a."[m
 [m
[32m+[m[32m        # Tiáº¿p tá»¥c Ä‘oáº¡n vÄƒn náº¿u cÃ³[m
         if user_input == "tiáº¿p tá»¥c" and user_context.get("dk"):[m
             tiep = user_context.get("tiep")[m
             current_position = user_context.get("current_position", 0)[m
[36m@@ -45,27 +51,32 @@[m [mdef chatbot_response(user_input):[m
             else:[m
                 return "KhÃ´ng cÃ³ vÄƒn báº£n Ä‘á»ƒ trÃ­ch xuáº¥t."[m
 [m
[31m-        # Tra trong ngá»¯ cáº£nh trÆ°á»›c[m
[31m-        text = xuli_doanvan_ngu_canh(user_input)[m
[32m+[m[32m        # Xá»­ lÃ½ tá»« ngá»¯ cáº£nh cÅ©[m
[32m+[m[32m        text, nguon = xuli_doanvan_ngu_canh(user_input)[m
         if text:[m
             user_response = tra_loi_tho(user_input, text)[m
[31m-            chatgpt_output, updated_history = capnhat([m
[31m-                user_input, user_response, user_context["history"])[m
[32m+[m[32m            chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
[32m+[m[32m                user_input, user_response, user_context["history"], nguon)[m
             user_context["history"] = updated_history[-20:][m
[32m+[m[32m            if danh_tu_rieng_moi:[m
[32m+[m[32m                user_context["danh_tu_rieng_truoc_do"] = danh_tu_rieng_moi[-1][m
             return chatgpt_output[m
 [m
[31m-        # Tra theo tá»« Ä‘iá»ƒn ná»™i bá»™[m
[32m+[m[32m        # Tá»« Ä‘iá»ƒn ná»™i bá»™[m
         ct1 = sau(user_input)[m
         ct2 = bay(user_input)[m
 [m
         if ct1 and ct2:[m
             output = tu_dien.get(ct1)[m
             luu_ngu_canh(user_input, output)[m
[31m-            chatgpt_output, updated_history = capnhat([m
[32m+[m[32m            chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
                 user_input, output, user_context["history"])[m
             user_context["history"] = updated_history[-20:][m
[32m+[m[32m            if danh_tu_rieng_moi:[m
[32m+[m[32m                user_context["danh_tu_rieng_truoc_do"] = danh_tu_rieng_moi[-1][m
             return chatgpt_output[m
 [m
[32m+[m[32m        # Má»™t sá»‘ cÃ¢u há»i Ä‘Æ¡n giáº£n[m
         if ct1 in danh_muc():[m
             if ct1 == "ngÃ y máº¥y":[m
                 return f"HÃ´m nay lÃ  {datetime.now().strftime('%d/%m/%Y')}"[m
[36m@@ -73,16 +84,19 @@[m [mdef chatbot_response(user_input):[m
                 return f"BÃ¢y giá» lÃ  {datetime.now().strftime('%H:%M')}"[m
             return tu_dien.get(ct1)[m
 [m
[31m-        # Cuá»‘i cÃ¹ng: tra Google[m
[31m-        user_response, tiep = search_google(user_input)[m
[32m+[m[32m        # Cuá»‘i cÃ¹ng, truy váº¥n Google[m
[32m+[m[32m        truy_van = tao_truy_van_bo_sung([m
[32m+[m[32m            user_input, user_context["danh_tu_rieng_truoc_do"])[m
[32m+[m[32m        user_response, tiep, nguon = search_google(truy_van, user_input)[m
         user_context["tiep"] = tiep[m
         user_context["dk"] = True[m
         user_context["current_position"] = len(user_response.split())[m
 [m
[31m-        chatgpt_output, updated_history = capnhat([m
[31m-            user_input, user_response, user_context["history"])[m
[32m+[m[32m        chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
[32m+[m[32m            user_input, user_response, user_context["history"], nguon)[m
         user_context["history"] = updated_history[-20:][m
[31m-[m
[32m+[m[32m        if danh_tu_rieng_moi:[m
[32m+[m[32m            user_context["danh_tu_rieng_truoc_do"] = danh_tu_rieng_moi[-1][m
         # Ghi dá»¯ liá»‡u má»›i vÃ o file[m
         # ghi_dulieu_txt(user_input, chatgpt_output)[m
 [m
[36m@@ -114,6 +128,7 @@[m [mdef main():[m
     no_speech_count = 0[m
     tiep = ""[m
     history = [][m
[32m+[m[32m    danh_tu_rieng_truoc_do = [][m
 [m
     try:[m
         speak_text("Xin chÃ o, tÃ´i giÃºp Ä‘Æ°á»£c gÃ¬ cho báº¡n?")[m
[36m@@ -145,6 +160,7 @@[m [mdef main():[m
                 chatgpt_output = "Ok, Ngá»¯ cáº£nh cuá»™c trÃ² chuyá»‡n Ä‘Ã£ xÃ³a"[m
                 xoa_ngucanh()[m
                 history = [][m
[32m+[m[32m                danh_tu_rieng_truoc_do = [][m
 [m
             elif user_input == "":[m
                 chatgpt_output = "Xin vui lÃ²ng cho biáº¿t yÃªu cáº§u cá»§a báº¡n"[m
[36m@@ -152,26 +168,31 @@[m [mdef main():[m
             else:[m
                 dk = False[m
                 user_input = user_input.lower().strip()[m
[31m-                text = xuli_doanvan_ngu_canh(user_input)[m
[32m+[m[32m                text, nguon = xuli_doanvan_ngu_canh(user_input)[m
                 best_related_answer = None[m
[32m+[m[32m                print(nguon)[m
 [m
                 if text:[m
[31m-                    best_related_answer = tra_loi_tho(user_input, text)[m
[32m+[m[32m                    best_related_answer = tra_loi_tho([m
[32m+[m[32m                        user_input, text)[m
 [m
                 if best_related_answer:[m
[31m-                    chatgpt_output, updated_history = capnhat([m
[31m-                        user_input, best_related_answer, history)[m
[32m+[m[32m                    # print([m
[32m+[m[32m                    # "káº¿t quáº£ tráº£ lá»i sau khi tra ngá»¯ cáº£nh qua hÃ m tra_loi_tho file main(): ", best_related_answer)[m
[32m+[m[32m                    chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
[32m+[m[32m                        user_input, best_related_answer, history, nguon)[m
                     history = updated_history[-20:][m
[31m-[m
[32m+[m[32m                    danh_tu_rieng_truoc_do = danh_tu_rieng_moi[-1] if danh_tu_rieng_moi else None[m
                 else:[m
                     ct1 = sau(user_input)[m
                     ct2 = bay(user_input)[m
                     print(ct1, ct2)[m
 [m
                     if ct1 and ct2 and ct1 in tu_dien and ct1 in ct2:[m
[31m-                        chatgpt_output, updated_history = capnhat([m
[32m+[m[32m                        chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
                             user_input, tu_dien[ct1], history)[m
                         history = updated_history[-20:][m
[32m+[m[32m                        danh_tu_rieng_truoc_do = danh_tu_rieng_moi[-1] if danh_tu_rieng_moi else None[m
                         luu_ngu_canh(user_input, chatgpt_output)[m
 [m
                     elif ct1 in danh_muc() and not ct2:[m
[36m@@ -183,16 +204,22 @@[m [mdef main():[m
                             chatgpt_output = tu_dien.get(ct1)[m
 [m
                     else:[m
[31m-                        user_response, tiep = search_google(user_input)[m
[32m+[m[32m                        truy_van = tao_truy_van_bo_sung([m
[32m+[m[32m                            user_input, danh_tu_rieng_truoc_do)[m
[32m+[m[32m                        user_response, tiep, nguon = search_google([m
[32m+[m[32m                            truy_van, user_input)[m
[32m+[m
                         dk = True[m
                         current_position = len(user_response.split())[m
[31m-                        chatgpt_output, updated_history = capnhat([m
[31m-                            user_input, user_response, history)[m
[32m+[m[32m                        chatgpt_output, updated_history, danh_tu_rieng_moi = capnhat([m
[32m+[m[32m                            user_input, user_response, history, nguon)[m
                         history = updated_history[-20:][m
[32m+[m[32m                        danh_tu_rieng_truoc_do = danh_tu_rieng_moi[-1] if danh_tu_rieng_moi else None[m
 [m
                         # ğŸ” LÆ°u dá»¯ liá»‡u vÃ o file .txt náº¿u lÃ  tá»« Google[m
                         # ghi_dulieu_txt(user_input, chatgpt_output)[m
[31m-[m
[32m+[m[32m            print([m
[32m+[m[32m                "káº¿t quáº£ test thá»­ user_input vá»›i hÃ m lay_tham_chieu_theo_dai_tu: ", danh_tu_rieng_truoc_do)[m
             hien_thi_vien_va_con_tro(chatgpt_output)[m
 [m
             if not cv:[m
[1mdiff --git a/module_ggl.py b/module_ggl.py[m
[1mindex f5f7923..a2f207b 100644[m
[1m--- a/module_ggl.py[m
[1m+++ b/module_ggl.py[m
[36m@@ -8,87 +8,10 @@[m [mimport requests[m
 from bs4 import BeautifulSoup[m
 import re[m
 import time[m
[31m-previous_answers = {}[m
[32m+[m[32mfrom functools import lru_cache[m
[32m+[m[32mfrom keyword_expander import tach_tu_khoa, loc_tu_quan_trong, expand_keywords[m
 [m
[31m-# Stopwords Ä‘á»ƒ loáº¡i bá» tá»« khÃ³a nhiá»…u[m
[31m-STOPWORDS = {[m
[31m-    "gÃ¬", "nÃ o", "ai", "sao", "Ã ", "vÃ ", "lÃ ", "cÃ¡c",[m
[31m-    "áº¥y", "thÃ¬", "á»Ÿ", "Ä‘Ã¢u", "vÃ¬", "ra", "nÃ³", "nhÆ°ng", "nhá»¯ng", "háº£", "sáº½", "máº¥y", "khÃ´ng"[m
[31m-}[m
[31m-STOP_PHRASES = [[m
[31m-    "bao nhiÃªu", "nhÆ° tháº¿ nÃ o", "lÃ m sao", "á»Ÿ Ä‘Ã¢u", "khi nÃ o", "lÃ  gÃ¬", "táº¡i sao", "vÃ¬ sao", "táº¡i vÃ¬ sao",[m
[31m-    "ai lÃ ", "ai Ä‘Ã£", "ai Ä‘ang", "cÃ³ Ä‘Ãºng khÃ´ng", "cÃ³ pháº£i lÃ ", "cÃ³ thá»ƒ", "cÃ³ hay khÃ´ng", "cÃ³ khÃ´ng",[m
[31m-    "nÃ o lÃ ", "cÃ¡i gÃ¬", "gÃ¬ váº­y", "tháº¿ nÃ o", "cÃ¡ch nÃ o", "pháº£i khÃ´ng", "ra sao", "Ä‘á»ƒ lÃ m gÃ¬",[m
[31m-    "máº¥y giá»", "máº¥y tuá»•i", "bao nhiÃªu", "kÃ©o dÃ i bao lÃ¢u",[m
[31m-    "báº±ng cÃ¡ch nÃ o", "vÃ¬ Ä‘iá»u gÃ¬", "cÃ³ nghÄ©a lÃ  gÃ¬", "Ä‘Æ°á»£c khÃ´ng", "Ä‘Æ°á»£c chá»©", "báº¡n cÃ³ biáº¿t", "lÃ  gÃ¬", "lÃ  ai", "cÃ³ biáº¿t"[m
[31m-][m
[31m-# Bá»™ má»Ÿ rá»™ng tá»« khÃ³a theo loáº¡i cÃ¢u há»i[m
[31m-BO_TU_MO_RONG = {[m
[31m-    "ai": ["ai", "ngÆ°á»i", "tÃªn", "gá»i lÃ ", "Ã´ng", "bÃ ", "cÃ´", "chÃº"],[m
[31m-    "trong": ["ngoÃ i", "trÃªn", "dÆ°á»›i", "trong"],[m
[31m-    "Ä‘Ã³ lÃ  gÃ¬": ["Ä‘Ã³ lÃ ", "gá»i lÃ ", "Ä‘Æ°á»£c xem lÃ ", "cÃ³ nghÄ©a lÃ ", "Ä‘á»‹nh nghÄ©a"],[m
[31m-    "á»Ÿ Ä‘Ã¢u": ["á»Ÿ", "táº¡i", "sá»‘ng", "nÆ¡i", "Ä‘á»‹a Ä‘iá»ƒm", "quÃª", "xuáº¥t thÃ¢n"],[m
[31m-    "khi nÃ o": ["khi", "nÄƒm", "thÃ¡ng", "ngÃ y", "lÃºc", "thá»i gian", "thá»i Ä‘iá»ƒm"],[m
[31m-    "vÃ¬ sao": ["vÃ¬", "do", "táº¡i vÃ¬", "bá»Ÿi vÃ¬", "nguyÃªn nhÃ¢n", "lÃ½ do"],[m
[31m-    "nhÆ° tháº¿ nÃ o": ["nhÆ° tháº¿ nÃ y", "cÃ¡ch", "ra sao", "mÃ´ táº£", "kiá»ƒu", "dáº¡ng", "Ä‘áº·c Ä‘iá»ƒm"],[m
[31m-    "bao nhiÃªu": ["sá»‘", "tá»•ng", "khoáº£ng" "chá»«ng"],[m
[31m-    "Ä‘ang lÃ m gÃ¬": ["Ä‘ang lÃ m", "hÃ nh Ä‘á»™ng", "thá»±c hiá»‡n", "cÃ´ng viá»‡c"],[m
[31m-    "phu nhÃ¢n": ["phu nhÃ¢n", "vá»£"],[m
[31m-    "chá»“ng": ["chá»“ng", "Ã´ng xÃ£", "phu quÃ¢n"],[m
[31m-    "triá»u Ä‘Ã¬nh": ["triá»u Ä‘Ã¬nh", "vua quan", "hoÃ ng vÆ°Æ¡ng", "vua chÃºa", "hoÃ ng triá»u"],[m
[31m-    "Ã´ng": ["Ã´ng", "cá»¥", "ngÃ i", "lÃ£o"],[m
[31m-    "bÃ ": ["bÃ ", "cÃ´", "má»£", "thÃ­m", "chá»‹", "dÃ¬"],[m
[31m-    "Ä‘Ã¬nh": ["Ä‘Ã¬nh", "Ä‘á»n", "miáº¿u", "chÃ¹a", "nÆ¡i thá»"],[m
[31m-    "quan": ["quan", "quan láº¡i", "quan chá»©c", "chá»©c tÆ°á»›c", "viÃªn chá»©c"],[m
[31m-    "quÃª": ["quÃª", "quÃ¡n", "nÆ¡i sinh", "sinh sá»‘ng", "hiá»‡n á»Ÿ táº¡i"],[m
[31m-    "cháº¿t": ["cháº¿t", "máº¥t", "tá»­ vong", "qua Ä‘á»i"][m
[31m-}[m
[31m-[m
[31m-[m
[31m-def tach_tu_khoa(text):[m
[31m-    """TÃ¡ch tá»« tá»« vÄƒn báº£n vÃ  loáº¡i bá» stopwords."""[m
[31m-    words = text.split()[m
[31m-    keywords = [[m
[31m-        word.lower().rstrip(".,?!")[m
[31m-        for word in words[m
[31m-        if word.lower().rstrip(".,?!") not in STOPWORDS[m
[31m-    ][m
[31m-    return keywords if keywords else [[m
[31m-        word.lower().rstrip(".,?!") for word in words[m
[31m-    ][m
[31m-[m
[31m-[m
[31m-def loc_tu_quan_trong(cau_hoi):[m
[31m-    cau_hoi = cau_hoi.lower()[m
[31m-    cau_hoi = re.sub(r"[^\w\s]", "", cau_hoi)  # loáº¡i bá» dáº¥u cÃ¢u[m
[31m-[m
[31m-    # Loáº¡i cÃ¡c cá»¥m stop phrases trÆ°á»›c[m
[31m-    for phrase in STOP_PHRASES:[m
[31m-        cau_hoi = cau_hoi.replace(phrase, "")[m
[31m-[m
[31m-    # TÃ¡ch tá»« vÃ  loáº¡i bá» stopwords Ä‘Æ¡n láº»[m
[31m-    words = cau_hoi.split()[m
[31m-    return [w for w in words if w not in STOPWORDS][m
[31m-[m
[31m-[m
[31m-def expand_keywords(question):[m
[31m-    """Má»Ÿ rá»™ng tá»« khÃ³a theo loáº¡i cÃ¢u há»i dá»±a trÃªn cÃ¡c cá»¥m tá»« Æ°u tiÃªn Ä‘Ã£ Ä‘á»‹nh nghÄ©a."""[m
[31m-    base_keywords = tach_tu_khoa(question)[m
[31m-    question_lower = question.lower()[m
[31m-    priority_keywords = [][m
[31m-    for nhom, cum_tu in BO_TU_MO_RONG.items():[m
[31m-        for phrase in cum_tu:[m
[31m-            if phrase in question_lower:[m
[31m-                priority_keywords.extend(cum_tu)[m
[31m-                # break  # Náº¿u má»™t cá»¥m phÃ¹ há»£p thÃ¬ thÃªm toÃ n bá»™ nhÃ³m[m
[31m-[m
[31m-    # TÃ¡ch cá»¥m tá»« thÃ nh tá»« Ä‘Æ¡n[m
[31m-    tu_don_tu_cum = [][m
[31m-    for cum in priority_keywords:[m
[31m-        tu_don_tu_cum.extend(cum.lower().split())[m
[31m-[m
[31m-    # Gá»™p vÃ  loáº¡i trÃ¹ng[m
[31m-    return list(set([kw.lower() for kw in base_keywords] + tu_don_tu_cum))[m
[32m+[m[32mprevious_answers = {}[m
 [m
 [m
 def capitalize_first_letter(paragraph):[m
[36m@@ -97,7 +20,8 @@[m [mdef capitalize_first_letter(paragraph):[m
     return paragraph[m
 [m
 [m
[31m-def similar(a, b):[m
[32m+[m[32m@lru_cache(maxsize=10000)[m
[32m+[m[32mdef cached_similarity(a, b):[m
     return SequenceMatcher(None, a, b).ratio()[m
 [m
 [m
[36m@@ -113,12 +37,19 @@[m [mdef find_keyword_positions2(text, keywords):[m
     return sorted(positions)[m
 [m
 [m
[31m-def luu_ngu_canh(question, answer, MAX_QUESTIONS=5):[m
[32m+[m[32mprevious_answers = {}[m
[32m+[m
[32m+[m
[32m+[m[32mdef luu_ngu_canh(question, answer, sources=None, MAX_QUESTIONS=5):[m
     if len(previous_answers) >= MAX_QUESTIONS:[m
[31m-        oldest_question = next(iter(previous_answers))  # Láº¥y cÃ¢u há»i cÅ© nháº¥t[m
[31m-        del previous_answers[oldest_question]  # XÃ³a cÃ¢u há»i cÅ© nháº¥t[m
[31m-    # LÆ°u cÃ¢u há»i vÃ  cÃ¢u tráº£ lá»i má»›i vÃ o tá»« Ä‘iá»ƒn[m
[31m-    previous_answers[question] = answer[m
[32m+[m[32m        oldest_question = next(iter(previous_answers))[m
[32m+[m[32m        del previous_answers[oldest_question][m
[32m+[m
[32m+[m[32m    previous_answers[question] = {[m
[32m+[m[32m        "answer": answer,[m
[32m+[m[32m        "sources": sources or [][m
[32m+[m[32m    }[m
[32m+[m
     return previous_answers[m
 [m
 [m
[36m@@ -129,30 +60,33 @@[m [mdef xoa_ngucanh():[m
 def xuli_doanvan_ngu_canh(user_input):[m
     user_keywords = loc_tu_quan_trong(user_input)[m
     print("tá»« sau khi lá»c bá» vÃ  tÃ¡ch tá»«: ", user_keywords)[m
[32m+[m
     max_similarity = 0[m
     best_paragraph = None[m
[32m+[m[32m    best_sources = [][m
 [m
[31m-    for previous_question, previous_answer in previous_answers.items():[m
[31m-        paragraphs = previous_answer.split('\n')[m
[32m+[m[32m    for previous_question, data in previous_answers.items():[m
[32m+[m[32m        answer_text = data.get("answer", "")[m
[32m+[m[32m        sources = data.get("sources", [])[m
 [m
[32m+[m[32m        paragraphs = answer_text.split('\n')[m
         for paragraph in paragraphs:[m
             keywords = tach_tu_khoa(paragraph)[m
             common = set(user_keywords) & set(keywords)[m
 [m
             if not user_keywords:[m
[31m-                continue  # trÃ¡nh chia 0[m
[32m+[m[32m                continue[m
 [m
             similarity = len(common) / len(user_keywords)[m
[31m-[m
             if similarity > max_similarity:[m
                 max_similarity = similarity[m
                 best_paragraph = paragraph[m
[32m+[m[32m                best_sources = sources[m
 [m
[31m-    if max_similarity >= 0.9:[m
[31m-        print("Ä‘oáº¡n  vÄƒn lá»c Ä‘Æ°á»£c: ", best_paragraph.strip())[m
[31m-        return best_paragraph.strip()[m
[32m+[m[32m    if max_similarity >= 0.85:[m
[32m+[m[32m        return best_paragraph.strip(), best_sources[m
     else:[m
[31m-        return None[m
[32m+[m[32m        return None, [][m
 [m
 [m
 def xuly_vanban_google(keyword, all_text):[m
[36m@@ -173,55 +107,43 @@[m [mdef xuly_vanban_google(keyword, all_text):[m
     return all_text  # Tráº£ vá» pháº§n vÄƒn báº£n Ä‘Æ°á»£c láº¥y ra tá»« vá»‹ trÃ­ Ä‘áº§u tiÃªn cá»§a tá»« khÃ³a[m
 [m
 [m
[31m-def search_google(keyword, num_of_results=5, max_sources=2, max_words=200):[m
[31m-[m
[32m+[m[32mdef search_google(keyword, user_input, num_of_results=5, max_sources=2, max_words=200):[m
     keyword = " ".join(loc_tu_quan_trong(keyword))[m
[32m+[m[32m    print(f"[ğŸ” Truy váº¥n Google sau lá»c]: {keyword}")[m
 [m
     try:[m
         search_results = search(keyword, num_results=num_of_results, lang='vi')[m
         all_paragraphs = [][m
         sources_count = 0[m
[32m+[m[32m        collected_sources = [][m
 [m
         for first_link in search_results:[m
             if sources_count >= max_sources:[m
                 break[m
[31m-[m
             if not first_link:[m
                 continue[m
 [m
             try:[m
                 response = requests.get(first_link, timeout=10, verify=False)[m
[31m-                time.sleep(random.uniform(0.3, 0.5))  # Sleep Ä‘á»ƒ trÃ¡nh bá»‹ cháº·n[m
[31m-[m
[32m+[m[32m                time.sleep(random.uniform(0.3, 0.5))[m
                 soup = BeautifulSoup(response.content, 'html.parser')[m
[31m-[m
[31m-                # XoÃ¡ cÃ¡c tháº» khÃ´ng mong muá»‘n[m
                 for tag in soup(['script', 'style', 'footer', 'header', 'nav', 'aside', 'address']):[m
                     tag.decompose()[m
[31m-[m
[31m-                # Láº¥y cÃ¡c Ä‘oáº¡n vÄƒn <p>, thÃªm separator Ä‘á»ƒ khÃ´ng dÃ­nh chá»¯[m
                 paragraphs = [[m
                     p.get_text(separator=" ", strip=True)[m
[31m-                    for p in soup.find_all('p')[m
[31m-                    if p.get_text(strip=True)[m
[32m+[m[32m                    for p in soup.find_all('p') if p.get_text(strip=True)[m
                 ][m
[31m-[m
                 all_paragraphs.extend(paragraphs)[m
[32m+[m[32m                collected_sources.append(first_link)[m
                 sources_count += 1[m
[31m-[m
[31m-            except requests.RequestException as e:[m
[31m-                # print(f"KhÃ´ng thá»ƒ truy cáº­p trang {first_link}: {e}")[m
[32m+[m[32m            except requests.RequestException:[m
                 pass[m
 [m
         if not all_paragraphs:[m
[31m-            return "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p"[m
[32m+[m[32m            return "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", [][m
 [m
[31m-        # Káº¿t há»£p vÃ  lÃ m sáº¡ch vÄƒn báº£n[m
         all_text = '\n'.join(filter(None, all_paragraphs))[m
[31m-        # XoÃ¡ khoáº£ng tráº¯ng thá»«a trÆ°á»›c dáº¥u cÃ¢u[m
         all_text = re.sub(r'\s+([.,;!?])', r'\1', all_text)[m
[31m-[m
[31m-        # CÃ¡c bÆ°á»›c lÃ m sáº¡ch Ä‘áº·c biá»‡t (theo yÃªu cáº§u trÆ°á»›c)[m
         patterns_to_remove = [[m
             r'HÃ£y xÃ¡c nháº­n ráº±ng quÃ½ vá»‹ lÃ  chuyÃªn gia chÄƒm sÃ³c sá»©c khá»e',[m
             r'LiÃªn káº¿t báº¡n vá»«a chá»n sáº½ Ä‘Æ°a báº¡n tá»›i trang web cá»§a má»™t bÃªn thá»© ba.*?ná»™i dung khÃ¡c vá» y táº¿ cÃ³ liÃªn quan\.',[m
[36m@@ -230,49 +152,44 @@[m [mdef search_google(keyword, num_of_results=5, max_sources=2, max_words=200):[m
         for pattern in patterns_to_remove:[m
             all_text = re.sub(pattern, '', all_text, flags=re.DOTALL)[m
 [m
[31m-        # ThÃªm hÃ m xá»­ lÃ½ vÄƒn báº£n náº¿u cÃ³[m
         try:[m
             all_text = xuly_vanban_google(keyword, all_text)[m
         except:[m
[31m-            pass  # Náº¿u khÃ´ng cÃ³ hÃ m nÃ y thÃ¬ bá» qua[m
[32m+[m[32m            pass[m
 [m
[31m-        # Backup version xoÃ¡ \n thÃ nh space[m
         text = all_text.replace("\n", " ")[m
 [m
         if text.strip():[m
             try:[m
[31m-                luu_ngu_canh(keyword, text)[m
[32m+[m[32m                luu_ngu_canh(keyword, text, collected_sources)[m
             except:[m
                 pass[m
[31m-        # Giá»›i háº¡n sá»‘ tá»«[m
[32m+[m
         words = all_text.split()[m
         if len(words) > max_words:[m
[31m-            doan_dau_text = tra_loi_tho(keyword, text)[m
[31m-            if doan_dau_text:[m
[31m-[m
[31m-                doan_dau = doan_dau_text[m
[31m-            else:[m
[31m-                doan_dau = f"Xin lá»—i, tÃ´i khÃ´ng tÃ¬m tháº¥y thÃ´ng tin {keyword}"[m
[31m-                print("Ä‘áº¡n vÄƒn seachgoogle sl 200: ", doan_dau)[m
[32m+[m[32m            doan_dau_text = tra_loi_tho(user_input, text, collected_sources)[m
[32m+[m[32m            doan_dau = doan_dau_text if doan_dau_text else f"Xin lá»—i, tÃ´i khÃ´ng tÃ¬m tháº¥y thÃ´ng tin {keyword}"[m
         else:[m
             doan_dau = all_text[m
[32m+[m
         if all_text.strip():[m
[31m-            return doan_dau, text[m
[32m+[m[32m            return doan_dau, text, collected_sources[m
         else:[m
[31m-            return "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p"[m
[32m+[m[32m            return "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", "Sorry, khÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p", [][m
 [m
     except Exception as e:[m
[31m-        return f"Sorry, Ä‘Ã£ xáº£y ra lá»—i: {str(e)}", f"Sorry, Ä‘Ã£ xáº£y ra lá»—i: {str(e)}"[m
[32m+[m[32m        return f"Sorry, Ä‘Ã£ xáº£y ra lá»—i: {str(e)}", f"Sorry, Ä‘Ã£ xáº£y ra lá»—i: {str(e)}", [][m
 [m
 [m
 def tra_loi_tho(user_input, text):[m
 [m
     if len(text) >= 100000:[m
         best_related_answer = traloi_theo_ngucanh1(user_input, text)[m
[31m-        print("Ä‘áº¡n vÄƒn seachgoogle sll: ", best_related_answer)[m
[32m+[m[32m        # print("Ä‘áº¡n vÄƒn tra ngá»¯ cáº£nh sll: ", best_related_answer)[m
     else:[m
[31m-        best_related_answer = traloi_theo_ngucanh2_1(user_input, text)[m
[31m-        print("Ä‘áº¡n vÄƒn seachgoogle sl 1000: ", best_related_answer)[m
[32m+[m[32m        best_related_answer = traloi_theo_ngucanh2_1_optimized([m
[32m+[m[32m            user_input, text)[m
[32m+[m[32m        # print("Ä‘áº¡n vÄƒn tra ngÅ© cáº£nh sl 1000: ", best_related_answer)[m
     return best_related_answer[m
 [m
 # DÃ™NG CHO VÄ‚N Báº¢N Lá»šN[m
[36m@@ -363,7 +280,7 @@[m [mdef traloi_theo_ngucanh1(user_input, text, similarity_threshold=0.75):[m
         for answer in filtered_answers:[m
             found_group = False[m
             for group in groups:[m
[31m-                if similar(answer, group[0]) > similarity_threshold:[m
[32m+[m[32m                if cached_similarity(answer, group[0]) > similarity_threshold:[m
                     group.append(answer)[m
                     found_group = True[m
                     break[m
[36m@@ -389,10 +306,9 @@[m [mdef traloi_theo_ngucanh2_1(user_input, text, k=0.75):[m
     - Tráº£ vá» Ä‘oáº¡n vÄƒn ngáº¯n gá»n, cÃ´ Ä‘á»ng, sáºµn sÃ ng lÃ m Ä‘áº§u vÃ o cho LLM.[m
     """[m
     keywords = expand_keywords(user_input)[m
[31m-    print(keywords)[m
 [m
     keyword_related_answers = {}[m
[31m-    y = (len(keywords) // 11) + 1[m
[32m+[m[32m    y = (len(keywords) // 20) + 1[m
     z = len(tach_tu_khoa(user_input)) + len(tach_tu_khoa(user_input))//2[m
     print("NgÆ°á»¡ng count:", y, "| Sá»‘ tá»« láº¥y Ä‘á»ƒ Ä‘áº¿m:", z)[m
 [m
[36m@@ -433,23 +349,19 @@[m [mdef traloi_theo_ngucanh2_1(user_input, text, k=0.75):[m
             words_in_related_answer) if word in keywords][m
         if keyword_indices:[m
             span = keyword_indices[-1] - keyword_indices[0] + 1[m
[31m-            density = count / span if span > 0 else 0[m
[32m+[m[32m            density = len(keyword_indices) / span if span > 0 else 0[m
         else:[m
             density = 0[m
 [m
         # Lá»c theo ngÆ°á»¡ng[m
         if count > y and density >= 0.1:[m
             selected_text = related_answer1[m
[31m-            for kw in keywords:[m
[31m-                if kw in keyword_related_answers:[m
[31m-                    keyword_related_answers[kw].append((selected_text, count))[m
[31m-                else:[m
[31m-                    keyword_related_answers[kw] = [(selected_text, count)][m
[32m+[m[32m            print(f"\nâœ”ï¸ CÃ¢u Ä‘Æ°á»£c chá»n: {selected_text}", "NgÆ°á»¡ng count:", y, "| Sá»‘ tá»« láº¥y Ä‘á»ƒ Ä‘áº¿m:", z, "| chiá»u dÃ i Ä‘oáº¡n chá»©a tá»« khÃ³a:",[m
[32m+[m[32m                  span, "| Sá»‘ tá»« khÃ³a ngÆ°á»¡ng:", count, "| Sá»‘ tá»« trong khoáº£ng:", len(keyword_indices), "| máº­t Ä‘á»™ tá»« khÃ³a", density)[m
[32m+[m[32m            keyword_related_answers.setdefault(selected_text, count)[m
 [m
     # Gom táº¥t cáº£ Ä‘oáº¡n vÃ  Ä‘áº¿m max[m
[31m-    all_related_answers = [][m
[31m-    for related_list in keyword_related_answers.values():[m
[31m-        all_related_answers.extend(related_list)[m
[32m+[m[32m    all_related_answers = list(keyword_related_answers.items())[m
 [m
     best_related_answers = [][m
     if all_related_answers:[m
[36m@@ -464,7 +376,7 @@[m [mdef traloi_theo_ngucanh2_1(user_input, text, k=0.75):[m
     for ans in best_related_answers:[m
         found = False[m
         for group in groups:[m
[31m-            if similar(ans, group[0]) > k:[m
[32m+[m[32m            if cached_similarity(ans, group[0]) > k:[m
                 group.append(ans)[m
                 found = True[m
                 break[m
[36m@@ -484,108 +396,108 @@[m [mdef traloi_theo_ngucanh2_1(user_input, text, k=0.75):[m
     if selected_answers:[m
 [m
         paragraph = clean_paragraph(selected_answers)  # KhÃ´ng shuffle[m
[32m+[m[32m        print("sau khi lá»c ngá»¯ cáº£nh 2_1: ", paragraph, len(paragraph))[m
         if len(paragraph) > 2000:[m
             paragraph = paragraph[:1000].rsplit(".", 1)[0] + "."[m
[32m+[m
         return paragraph[m
     return None[m
 [m
 [m
[31m-def restructure_response_v2(selected_answers):[m
[31m-    if not selected_answers:[m
[31m-        return None[m
[31m-[m
[31m-    selected_answers = [s.strip().rstrip('.') for s in selected_answers][m
[31m-    n = len(selected_answers)[m
[31m-[m
[31m-    if n == 1:[m
[31m-        return f"{selected_answers[0]}."[m
[31m-[m
[31m-    elif n == 2:[m
[31m-        return ([m
[31m-            f"{selected_answers[0]}. BÃªn cáº¡nh Ä‘Ã³, {selected_answers[1].lower()}."[m
[31m-        )[m
[31m-[m
[31m-    elif n == 3:[m
[31m-        return ([m
[31m-            f"{selected_answers[0]}. "[m
[31m-            f"KhÃ´ng nhá»¯ng váº­y, {selected_answers[1].lower()}. "[m
[31m-            f"Cuá»‘i cÃ¹ng, {selected_answers[2].lower()}."[m
[31m-        )[m
[32m+[m[32mdef traloi_theo_ngucanh2_1_optimized(user_input, text, k=0.75):[m
[32m+[m[32m    """[m
[32m+[m[32m    Káº¿t há»£p tá»‘c Ä‘á»™ cá»§a báº£n 1 vÃ  Ä‘á»™ chÃ­nh xÃ¡c lá»c tá»« báº£n 2.[m
[32m+[m[32m    TrÃ­ch xuáº¥t cÃ¡c cÃ¢u liÃªn quan Ä‘áº¿n cÃ¢u há»i dá»±a trÃªn tá»« khÃ³a má»Ÿ rá»™ng vÃ  ngá»¯ cáº£nh.[m
[32m+[m[32m    """[m
[32m+[m[32m    keywords = expand_keywords(user_input)[m
[32m+[m[32m    keyword_related_answers = {}[m
 [m
[31m-    else:[m
[31m-        # Vá»›i nhiá»u hÆ¡n 3 Ä‘oáº¡n, nhÃ³m vÃ  chuyá»ƒn thÃ nh Ä‘oáº¡n tÃ³m táº¯t[m
[31m-        intro = "DÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng Ä‘iá»ƒm ná»•i báº­t:"[m
[31m-        bullets = "\n".join([f"- {s}." for s in selected_answers])[m
[31m-        return f"{intro}\n{bullets}"[m
[32m+[m[32m    # Giá»¯ nguyÃªn cÃ¡ch tÃ­nh nhÆ° báº£n 2[m
[32m+[m[32m    base_keywords = tach_tu_khoa(user_input)[m
[32m+[m[32m    z = 5 if len(base_keywords) <= 3 else ([m
[32m+[m[32m        len(base_keywords) + len(base_keywords) // 2)[m
[32m+[m[32m    y = 2 if ((len(keywords) // 11) + 1) < 2 else ((len(keywords) // 11) + 1)[m
 [m
[32m+[m[32m    print("NgÆ°á»¡ng count:", y, "| Sá»‘ tá»« láº¥y Ä‘á»ƒ Ä‘áº¿m:", z)[m
 [m
[31m-def restructure_response_v2_1(selected_answers, keywords=None):[m
[31m-    if not selected_answers:[m
[31m-        return None[m
[32m+[m[32m    keyword_positions = find_keyword_positions2(text, keywords)[m
 [m
[31m-    selected_answers = [s.strip().rstrip('.') for s in selected_answers][m
[31m-    n = len(selected_answers)[m
[32m+[m[32m    for start_index in keyword_positions:[m
[32m+[m[32m        sentence_start_index = max([m
[32m+[m[32m            text.rfind('.', 0, start_index),[m
[32m+[m[32m            text.rfind('!', 0, start_index),[m
[32m+[m[32m            text.rfind('?', 0, start_index)[m
[32m+[m[32m        ) + 1[m
 [m
[31m-    TRANSITIONS = {[m
[31m-        "má»Ÿ Ä‘áº§u": ["TrÆ°á»›c háº¿t", "Äáº§u tiÃªn", "Thoáº¡t tiÃªn"],[m
[31m-        "bá»• sung": ["NgoÃ i ra", "BÃªn cáº¡nh Ä‘Ã³", "ThÃªm vÃ o Ä‘Ã³"],[m
[31m-        "nháº¥n máº¡nh": ["ÄÃ¡ng chÃº Ã½ lÃ ", "Äáº·c biá»‡t lÃ "],[m
[31m-        "káº¿t luáº­n": ["Cuá»‘i cÃ¹ng", "Tá»•ng káº¿t láº¡i", "Sau cÃ¹ng"][m
[31m-    }[m
[32m+[m[32m        # TÃ¬m cuá»‘i cÃ¢u[m
[32m+[m[32m        temp_index = start_index[m
[32m+[m[32m        while True:[m
[32m+[m[32m            end_index = text.find(".", temp_index)[m
[32m+[m[32m            if end_index == -1:[m
[32m+[m[32m                break[m
[32m+[m[32m            if end_index + 1 < len(text) and text[end_index + 1] in [' ', '\n']:[m
[32m+[m[32m                break[m
[32m+[m[32m            temp_index = end_index + 1[m
 [m
[31m-    def pick(trans_type):[m
[31m-        return random.choice(TRANSITIONS.get(trans_type, [""]))[m
[32m+[m[32m        related_answer = text[start_index:end_index +[m
[32m+[m[32m                              1] if end_index != -1 else text[start_index:][m
[32m+[m[32m        related_answer1 = text[sentence_start_index:end_index +[m
[32m+[m[32m                               1] if end_index != -1 else text[sentence_start_index:][m
 [m
[31m-    def summarize_keywords(keywords):[m
[31m-        try:[m
[31m-            from sklearn.feature_extraction.text import TfidfVectorizer[m
[31m-            import numpy as np[m
[31m-[m
[31m-            vectorizer = TfidfVectorizer(stop_words='english', max_features=10)[m
[31m-            X = vectorizer.fit_transform(keywords)[m
[31m-            terms = vectorizer.get_feature_names_out()[m
[31m-            scores = X.toarray().sum(axis=0)[m
[31m-            sorted_indices = np.argsort(scores)[::-1][m
[31m-            top_terms = [terms[i] for i in sorted_indices[:3]][m
[31m-            return ', '.join(top_terms)[m
[31m-        except:[m
[31m-            return ', '.join(kw.split()[0] for kw in keywords[:2])[m
[32m+[m[32m        # TÃ­nh count vÃ  density[m
[32m+[m[32m        words_in_related_answer = related_answer.lower().replace([m
[32m+[m[32m            ",", " ").rstrip(',.?!').split()[m
[32m+[m[32m        count = sum([m
[32m+[m[32m            1 for word in words_in_related_answer[:z] if word in keywords)[m
[32m+[m[32m        print(related_answer, count)[m
[32m+[m[32m        keyword_indices = [i for i, word in enumerate([m
[32m+[m[32m            words_in_related_answer) if word in keywords][m
[32m+[m[32m        if keyword_indices:[m
[32m+[m[32m            span = keyword_indices[-1] - keyword_indices[0] + 1[m
[32m+[m[32m            density = len(keyword_indices) / span if span > 0 else 0[m
[32m+[m[32m        else:[m
[32m+[m[32m            density = 0[m
 [m
[31m-    def generate_intro(keywords):[m
[31m-        if not keywords:[m
[31m-            return ""[m
[31m-        topic = summarize_keywords(keywords)[m
[31m-        return f"LiÃªn quan Ä‘áº¿n {topic}, dÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng Ä‘iá»ƒm ná»•i báº­t:"[m
[32m+[m[32m        # Lá»c theo ngÆ°á»¡ng[m
[32m+[m[32m        if count >= y and density >= 0.1:[m
[32m+[m[32m            selected_text = related_answer1.strip()[m
[32m+[m[32m            # Chá»‰ lÆ°u 1 láº§n má»—i Ä‘oáº¡n[m
[32m+[m[32m            keyword_related_answers[selected_text] = count[m
 [m
[31m-    avg_len = sum(len(s.split()) for s in selected_answers) / n[m
[32m+[m[32m    # Láº¥y nhá»¯ng Ä‘oáº¡n cÃ³ count gáº§n max[m
[32m+[m[32m    all_related_answers = list(keyword_related_answers.items())[m
[32m+[m[32m    best_related_answers = [][m
[32m+[m[32m    if all_related_answers:[m
[32m+[m[32m        max_matched = max(c for _, c in all_related_answers)[m
[32m+[m[32m        best_related_answers = [[m
[32m+[m[32m            ans for ans, c in all_related_answers if c >= max_matched - 1[m
[32m+[m[32m        ][m
 [m
[31m-    if n == 1:[m
[31m-        return f"{generate_intro(keywords)} {selected_answers[0]}."[m
[32m+[m[32m    # Gom nhÃ³m Ä‘oáº¡n tÆ°Æ¡ng tá»±[m
[32m+[m[32m    groups = [][m
[32m+[m[32m    for ans in best_related_answers:[m
[32m+[m[32m        found = False[m
[32m+[m[32m        for group in groups:[m
[32m+[m[32m            if cached_similarity(ans, group[0]) > k:[m
[32m+[m[32m                group.append(ans)[m
[32m+[m[32m                found = True[m
[32m+[m[32m                break[m
[32m+[m[32m        if not found:[m
[32m+[m[32m            groups.append([ans])[m
 [m
[31m-    elif n == 2:[m
[31m-        return ([m
[31m-            f"{generate_intro(keywords)} {selected_answers[0]}. {pick('bá»• sung')}, {selected_answers[1].lower()}."[m
[31m-        )[m
[32m+[m[32m    # Láº¥y má»—i nhÃ³m má»™t Ä‘oáº¡n[m
[32m+[m[32m    selected_answers = [capitalize_first_letter([m
[32m+[m[32m        random.choice(g)) for g in groups][m
 [m
[31m-    elif n == 3:[m
[31m-        return ([m
[31m-            f"{generate_intro(keywords)} {pick('má»Ÿ Ä‘áº§u')}, {selected_answers[0].lower()}. "[m
[31m-            f"{pick('bá»• sung')}, {selected_answers[1].lower()}. "[m
[31m-            f"{pick('káº¿t luáº­n')}, {selected_answers[2].lower()}."[m
[31m-        )[m
[32m+[m[32m    def clean_paragraph(sentences):[m
[32m+[m[32m        text = ' '.join(sentences)[m
[32m+[m[32m        return re.sub(r'\s+', ' ', text).strip()[m
 [m
[31m-    else:[m
[31m-        if avg_len <= 10:[m
[31m-            phrases = [][m
[31m-            for i, s in enumerate(selected_answers):[m
[31m-                if i == 0:[m
[31m-                    phrases.append(f"{pick('má»Ÿ Ä‘áº§u')}, {s.lower()}")[m
[31m-                elif i == n - 1:[m
[31m-                    phrases.append(f"{pick('káº¿t luáº­n')}, {s.lower()}")[m
[31m-                else:[m
[31m-                    phrases.append(f"{pick('bá»• sung')}, {s.lower()}")[m
[31m-            return f"{generate_intro(keywords)} " + ". ".join(phrases) + "."[m
[32m+[m[32m    if selected_answers:[m
[32m+[m[32m        paragraph = clean_paragraph(selected_answers)[m
[32m+[m[32m        if len(paragraph) > 2000:[m
[32m+[m[32m            paragraph = paragraph[:1000].rsplit(".", 1)[0] + "."[m
[32m+[m[32m        print("âœ”ï¸ Äoáº¡n trÃ­ch ngá»¯ cáº£nh:", paragraph, len(paragraph))[m
[32m+[m[32m        return paragraph[m
 [m
[31m-        else:[m
[31m-            bullets = "\n".join([f"- {s}." for s in selected_answers])[m
[31m-            return f"{generate_intro(keywords)}\n{bullets}"[m
[32m+[m[32m    return None[m
[1mdiff --git a/ngu_canh_truy_van.py b/ngu_canh_truy_van.py[m
[1mnew file mode 100644[m
[1mindex 0000000..0ecab44[m
[1m--- /dev/null[m
[1m+++ b/ngu_canh_truy_van.py[m
[36m@@ -0,0 +1,24 @@[m
[32m+[m[32m# ngu_canh_truy_van.py[m
[32m+[m
[32m+[m[32mdef co_can_bo_sung_chu_de(user_input: str) -> bool:[m
[32m+[m[32m    """[m
[32m+[m[32m    Kiá»ƒm tra xem user_input cÃ³ chá»©a Ä‘áº¡i tá»« hoáº·c tá»« chá»‰ mÆ¡ há»“,[m
[32m+[m[32m    náº¿u cÃ³ thÃ¬ cáº§n bá»• sung chá»§ Ä‘á» (danh tá»« riÃªng) vÃ o cÃ¢u há»i.[m
[32m+[m[32m    """[m
[32m+[m[32m    tu_dai_dien = [[m
[32m+[m[32m        "Ã´ng áº¥y", "bÃ  áº¥y", "há»", "nÃ³", "cÃ´ áº¥y", "cáº­u áº¥y", "ngÆ°á»i áº¥y", "anh ta", "chá»‹ ta", "Ã´ng", "bÃ ",[m
[32m+[m[32m        "vá»‹ Ä‘Ã³", "nhÃ¢n váº­t Ä‘Ã³", "váº­t Ä‘Ã³", "váº­t nÃ y", "chuyá»‡n Ä‘Ã³", "viá»‡c áº¥y", "chá»§ Ä‘á» Ä‘Ã³",[m
[32m+[m[32m        "nÃ³ lÃ  gÃ¬", "viá»‡c Ä‘Ã³", "hÃ nh Ä‘á»™ng Ä‘Ã³", "Ä‘iá»u Ä‘Ã³", "trÆ°á»ng há»£p Ä‘Ã³"[m
[32m+[m[32m    ][m
[32m+[m[32m    user_input = user_input.lower()[m
[32m+[m[32m    return any(cum in user_input for cum in tu_dai_dien)[m
[32m+[m
[32m+[m
[32m+[m[32mdef tao_truy_van_bo_sung(user_input: str, danh_tu_rieng_truoc_do: str = None) -> str:[m
[32m+[m[32m    """[m
[32m+[m[32m    Náº¿u cÃ¢u há»i cáº§n thÃªm chá»§ Ä‘á» thÃ¬ ná»‘i chá»§ Ä‘á» cÅ© vÃ o Ä‘áº§u cÃ¢u há»i.[m
[32m+[m[32m    Náº¿u khÃ´ng, tráº£ láº¡i nguyÃªn vÄƒn user_input.[m
[32m+[m[32m    """[m
[32m+[m[32m    if danh_tu_rieng_truoc_do and co_can_bo_sung_chu_de(user_input):[m
[32m+[m[32m        return f"{danh_tu_rieng_truoc_do.strip()} {user_input.strip()}"[m
[32m+[m[32m    return user_input.strip()[m
